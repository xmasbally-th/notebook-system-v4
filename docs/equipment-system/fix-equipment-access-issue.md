# ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ

## üîç ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Ç‡∏≠‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (`/admin/equipment`) ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:

```
Error loading equipment list: FirebaseError: Missing or insufficient permissions
```

### ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏´‡∏•‡∏±‡∏Å:

1. **Auth Token ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ Refresh** - ‡πÄ‡∏°‡∏∑‡πà‡∏≠ admin approve user ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ user, auth token ‡∏Ç‡∏≠‡∏á user ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• status ‡πÉ‡∏´‡∏°‡πà

2. **Firestore Rules ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Status** - Firestore rules ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö `equipmentManagement` collection ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ user ‡∏°‡∏µ `status == 'approved'`:
   ```javascript
   allow read: if isApprovedUser();
   ```

3. **Token ‡πÑ‡∏°‡πà Sync ‡∏Å‡∏±‡∏ö Firestore** - Auth token ‡∏ó‡∏µ‡πà client ‡πÉ‡∏ä‡πâ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ sync ‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÉ‡∏ô Firestore

## ‚úÖ ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏° Refresh Token (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏à‡∏≠‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î permission denied ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå:

1. ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° **"üîÑ Refresh Token"** ‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ error
2. ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞ refresh ‡πÄ‡∏™‡∏£‡πá‡∏à
3. ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2: Sign Out ‡πÅ‡∏•‡∏∞ Sign In ‡πÉ‡∏´‡∏°‡πà

1. ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° Sign Out ‡∏ó‡∏µ‡πà‡∏°‡∏∏‡∏°‡∏ö‡∏ô‡∏Ç‡∏ß‡∏≤
2. ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
3. ‡∏•‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 3: ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö

1. ‡∏Å‡∏î F5 ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° Refresh ‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå
2. ‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà
3. ‡∏•‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 4: ‡∏•‡∏ö Cache ‡πÅ‡∏•‡∏∞ Cookies

1. ‡πÄ‡∏õ‡∏¥‡∏î Developer Tools (F12)
2. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Application > Storage
3. ‡∏Ñ‡∏•‡∏¥‡∏Å "Clear site data"
4. ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà

## üîß ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß

### 1. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Refresh Token ‡πÉ‡∏ô AuthContext

```javascript
const refreshToken = async () => {
  try {
    if (!user) {
      throw new Error('No user logged in');
    }
    
    console.log('üîÑ Manually refreshing token...');
    const token = await user.getIdToken(true);
    console.log('‚úÖ Token manually refreshed');
    
    return token;
  } catch (error) {
    console.error('‚ùå Manual token refresh error:', error);
    handleError(error, 'manual_token_refresh');
    throw error;
  }
};
```

### 2. ‡πÄ‡∏û‡∏¥‡πà‡∏° Error Handling ‡πÉ‡∏ô EquipmentManagementContainer

- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ error ‡πÄ‡∏õ‡πá‡∏ô permission error ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
- ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° "Refresh Token" ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏à‡∏≠ permission error
- ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤

### 3. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏° Refresh Token ‡πÉ‡∏ô AdminEquipmentManagement

- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö refresh token ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á
- Auto reload ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å refresh token ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

## üìã ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤

### ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö User Status

```javascript
// ‡πÉ‡∏ô Browser Console
console.log('User:', auth.currentUser);
console.log('User Profile:', userProfile);
```

‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤:
- `userProfile.role === 'admin'`
- `userProfile.status === 'approved'`

### ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Auth Token

```javascript
// ‡πÉ‡∏ô Browser Console
auth.currentUser.getIdTokenResult().then(result => {
  console.log('Token claims:', result.claims);
  console.log('Token expiration:', result.expirationTime);
});
```

### ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Firestore Rules

‡πÉ‡∏ô Firebase Console > Firestore Database > Rules:

```javascript
match /equipmentManagement/{equipmentId} {
  allow read: if isApprovedUser();
  // ...
}

function isApprovedUser() {
  return isAuthenticated() && 
         exists(/databases/$(database)/documents/users/$(request.auth.uid)) &&
         get(/databases/$(database)/documents/users/$(request.auth.uid)).data.status == 'approved';
}
```

## üö® ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏û‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

### 1. User Document ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô Firestore

**‡∏≠‡∏≤‡∏Å‡∏≤‡∏£:** Permission denied ‡πÅ‡∏°‡πâ‡∏ß‡πà‡∏≤ user ‡∏à‡∏∞ login ‡πÅ‡∏•‡πâ‡∏ß

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
```javascript
// ‡∏™‡∏£‡πâ‡∏≤‡∏á user document ‡πÉ‡∏´‡∏°‡πà
const userDocRef = doc(db, 'users', user.uid);
await setDoc(userDocRef, {
  uid: user.uid,
  email: user.email,
  displayName: user.displayName,
  role: 'admin',
  status: 'approved',
  createdAt: serverTimestamp(),
  updatedAt: serverTimestamp()
});
```

### 2. Firestore Rules ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ Deploy

**‡∏≠‡∏≤‡∏Å‡∏≤‡∏£:** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç rules ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡πÄ‡∏à‡∏≠ permission denied

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
```bash
firebase deploy --only firestore:rules
```

### 3. Token ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏

**‡∏≠‡∏≤‡∏Å‡∏≤‡∏£:** ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏ï‡∏≠‡∏ô‡πÅ‡∏£‡∏Å ‡πÅ‡∏ï‡πà‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
- ‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏° Refresh Token
- ‡∏´‡∏£‡∏∑‡∏≠ Sign Out ‡πÅ‡∏•‡∏∞ Sign In ‡πÉ‡∏´‡∏°‡πà

## üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏

- Auth token ‡∏°‡∏µ‡∏≠‡∏≤‡∏¢‡∏∏ 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
- ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å token ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ‡∏ï‡πâ‡∏≠‡∏á refresh token ‡πÉ‡∏´‡∏°‡πà
- ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á user status ‡πÉ‡∏ô Firestore ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ update auth token ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- ‡∏ï‡πâ‡∏≠‡∏á refresh token ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠ sign out/in ‡πÉ‡∏´‡∏°‡πà

## üîó ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á

- `src/contexts/AuthContext.js` - Auth context ‡πÅ‡∏•‡∏∞ refresh token function
- `src/components/equipment/EquipmentManagementContainer.js` - Equipment list container
- `src/components/admin/AdminEquipmentManagement.js` - Admin equipment management page
- `src/services/equipmentManagementService.js` - Equipment management service
- `firestore.rules` - Firestore security rules
